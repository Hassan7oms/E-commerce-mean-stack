<div class="orders-page">
  <div class="container">
    <div class="page-header">
      <h1>My Orders</h1>
      <p>Track and manage your orders</p>
    </div>

    <!-- Success/Error Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      <div class="alert-content">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22,4 12,14.01 9,11.01"/>
        </svg>
        {{ successMessage }}
      </div>
      <button (click)="dismissMessage()" class="alert-close">×</button>
    </div>

    <div *ngIf="error" class="alert alert-error">
      <div class="alert-content">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"/>
          <path d="M15 9l-6 6"/>
          <path d="M9 9l6 6"/>
        </svg>
        {{ error }}
      </div>
      <button (click)="dismissMessage()" class="alert-close">×</button>
    </div>

    <!-- Filter Options -->
    <div *ngIf="!isLoading && !error" class="filter-section">
      <label for="status-filter">Filter by status:</label>
      <select id="status-filter" [(ngModel)]="selectedStatus" (change)="onStatusChange(selectedStatus)">
        <option *ngFor="let status of statusOptions" [value]="status.value">
          {{ status.label }}
        </option>
      </select>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading your orders...</p>
    </div>

    <!-- Orders List -->
    <div *ngIf="!isLoading && !error" class="orders-content">
      <div *ngIf="orders.length === 0" class="no-orders">
        <div class="no-orders-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
            <path d="M16 11V7a4 4 0 0 0-8 0v4M5 9h14l1 12H4L5 9z"/>
          </svg>
        </div>
        <h3>No orders found</h3>
        <p *ngIf="selectedStatus === 'all'">You haven't placed any orders yet. Start shopping to see your orders here.</p>
        <p *ngIf="selectedStatus !== 'all'">No orders found with status "{{ selectedStatus }}".</p>
        <a routerLink="/products" class="shop-btn">Start Shopping</a>
      </div>

      <div *ngIf="orders.length > 0" class="orders-list">
        <div *ngFor="let order of orders" class="order-card">
          <div class="order-header">
            <div class="order-info">
              <h3>Order #{{ order.ordernumber }}</h3>
              <p class="order-date">Placed on {{ formatDate(order.createdAt) }}</p>
            </div>
            <div class="order-status">
              <span [class]="getOrderStatusClass(order.status)">{{ order.status | titlecase }}</span>
            </div>
          </div>

          <div class="order-items">
            <div *ngFor="let item of order.items" class="order-item">
              <img [src]="getItemImageUrl(item)" [alt]="item.title" class="item-image">
              <div class="item-details">
                <a [routerLink]="['/product', getProductSlug(item)]" class="item-title">{{ item.title }}</a>
                <div class="item-variant" *ngIf="item.variantDetails">
                  <span *ngIf="item.variantDetails.size">Size: {{ item.variantDetails.size }}</span>
                  <span *ngIf="item.variantDetails.color">Color: {{ item.variantDetails.color }}</span>
                </div>
                <p class="item-quantity">Quantity: {{ item.quantity }}</p>
              </div>
              <div class="item-price">
                {{ formatPrice(item.price * item.quantity) }}
              </div>
            </div>
          </div>

          <div class="order-summary">
            <div class="shipping-address">
              <h4>Shipping Address:</h4>
              <p>
                {{ order.shippingAddress.street }}, {{ order.shippingAddress.building }}, 
                Apt {{ order.shippingAddress.apartment }}<br>
                {{ order.shippingAddress.area }}, {{ order.shippingAddress.city }}
              </p>
            </div>
            <div class="payment-method">
              <h4>Payment Method:</h4>
              <p>{{ order.paymentMethod | titlecase }}</p>
            </div>
          </div>

          <div class="order-footer">
            <div class="order-total">
              <strong>Total: {{ formatPrice(order.totalPrice) }}</strong>
            </div>
            <div class="order-actions">
              <button 
                *ngIf="canCancelOrder(order)" 
                (click)="cancelOrder(order._id)" 
                class="action-btn cancel-btn">
                Cancel Order
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div *ngIf="totalPages > 1" class="pagination">
        <button 
          *ngFor="let page of [].constructor(totalPages); let i = index" 
          (click)="onPageChange(i + 1)"
          [class.active]="currentPage === i + 1"
          class="page-btn">
          {{ i + 1 }}
        </button>
      </div>
    </div>
  </div>
</div>
