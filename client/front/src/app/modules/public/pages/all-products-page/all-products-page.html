<!-- All Products Page -->

<div class="collection-container">
    <!-- Page Header -->
    <header class="collection-header">
        <div class="header-icon-wrapper">
            <!-- Shopping bag icon -->
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
        </div>
        <h1>All Products</h1>
        <p>Explore our complete collection of {{ getTotalProductCount() }} products across all categories.</p>
    </header>

    <!-- Main Content Area -->
    <div class="collection-body">
        <!-- Filters Sidebar (Left) -->
        <aside class="filters-sidebar" [formGroup]="filterForm">
            <div class="filter-group">
                <h3 class="filter-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
                    Filters
                </h3>
                <button type="button" class="reset-filters-btn" (click)="resetFilters()">Reset All</button>
            </div>
            
            <div class="filter-group">
                <label for="search">Search Products</label>
                <div class="search-input-wrapper">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                    <input type="text" id="search" formControlName="search" placeholder="Search by name or description...">
                </div>
            </div>
            
            <div class="filter-group">
                <label for="category">Category</label>
                <select id="category" formControlName="category">
                    <option value="all">All Categories</option>
                    <option *ngFor="let category of categories" [value]="category._id">{{ category.name }}</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Price Range</label>
                <div class="price-range-container">
                    <div class="price-inputs">
                        <div class="price-input-group">
                            <label for="priceMin">Min</label>
                            <input type="number" id="priceMin" formControlName="priceMin" min="0" placeholder="0">
                        </div>
                        <span class="price-separator">-</span>
                        <div class="price-input-group">
                            <label for="priceMax">Max</label>
                            <input type="number" id="priceMax" formControlName="priceMax" min="0" placeholder="5000">
                        </div>
                    </div>
                    <div class="price-range-display">
                        {{ filterForm.get('priceMin')?.value || 0 }} EGP - {{ filterForm.get('priceMax')?.value || 5000 }} EGP
                    </div>
                </div>
            </div>
        </aside>

        <!-- Product Listing (Right) -->
        <main class="product-listing">
            <!-- Top Control Bar -->
            <div class="controls-bar">
                <div class="results-info">
                    <span class="product-count">
                        <strong>{{ getProductCount() }}</strong> 
                        <span *ngIf="getProductCount() !== getTotalProductCount()">of {{ getTotalProductCount() }}</span>
                        products found
                    </span>
                </div>
                <div class="sort-controls">
                    <label for="sortBy">Sort by:</label>
                    <select id="sortBy" formControlName="sortBy" (change)="applySorting()">
                        <option *ngFor="let option of sortOptions" [value]="option.value">{{ option.label }}</option>
                    </select>
                </div>
            </div>

            <!-- Handle Loading State -->
            <div *ngIf="isLoading" class="state-container">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>

            <!-- Handle Error State -->
            <div *ngIf="error" class="state-container error">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                <p>{{ error }}</p>
                <button type="button" class="retry-btn" (click)="loadInitialData()">Try Again</button>
            </div>

            <!-- Handle Empty State -->
            <div *ngIf="!isLoading && !error && filteredProducts.length === 0" class="state-container empty">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M20.2 20.2c2.04-2.03.02-7.36-4.5-11.9-4.54-4.52-9.87-6.54-11.9-4.5-2.03 2.04-.02 7.36 4.5 11.9 4.54 4.52 9.87 6.54 11.9 4.5z"></path></svg>
                <p>No products found matching your criteria.</p>
                <button type="button" class="reset-filters-btn" (click)="resetFilters()">Clear Filters</button>
            </div>
            
            <!-- Dynamic Product Grid -->
            <div *ngIf="!isLoading && !error && filteredProducts.length > 0" class="product-grid">
                <app-product-card 
                    *ngFor="let product of filteredProducts; trackBy: trackByProductId" 
                    [product]="product"
                    [showAddToCart]="true"
                    [showAddToWishlist]="true">
                </app-product-card>
            </div>

            <!-- Pagination (if needed) -->
            <div *ngIf="!isLoading && !error && filteredProducts.length > 12" class="pagination-container">
                <!-- Add pagination controls here if you want to implement pagination -->
                <p class="pagination-info">Showing all {{ filteredProducts.length }} products</p>
            </div>
        </main>
    </div>
</div>
