<!-- src/app/pages/profile/profile-page.html -->

<div class="profile-page">
  <div class="container">
    <!-- Profile Header with Avatar -->
    <div class="profile-header">
      <div class="profile-avatar">
        <div class="avatar-circle">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
      </div>
      <div class="profile-info-header">
        <h1>My Profile</h1>
        <p class="profile-subtitle">Manage your account information and preferences</p>
        <p class="welcome-text" *ngIf="currentUser">
          Welcome back, <strong>{{ currentUser.name.first }}!</strong>
        </p>
      </div>
    </div>

    <div *ngIf="currentUser" class="profile-content">
      <!-- Profile Information Card -->
      <div class="profile-card">
        <div class="card-header">
          <div class="header-left">
            <h2>Personal Information</h2>
            <p>Update your personal details and information</p>
          </div>
          <button *ngIf="!isEditing" (click)="toggleEdit()" class="edit-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
              <path d="m18.5 2.5 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Edit Profile
          </button>
        </div>

        <div class="profile-form">
          <div class="form-grid">
            <!-- Full Name -->
            <div class="form-group">
              <label class="form-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                  <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Full Name
              </label>
              
              <!-- Display View -->
              <div *ngIf="!isEditing" class="form-display">
                {{ currentUser.name.first }} {{ currentUser.name.last }}
              </div>
              
              <!-- Edit View -->
              <div *ngIf="isEditing" class="name-inputs">
                <input 
                  [(ngModel)]="profileForm.firstName" 
                  type="text" 
                  class="form-input" 
                  placeholder="First Name"
                  required>
                <input 
                  [(ngModel)]="profileForm.lastName" 
                  type="text" 
                  class="form-input" 
                  placeholder="Last Name"
                  required>
              </div>
            </div>

            <!-- Email -->
            <div class="form-group">
              <label class="form-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                  <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
                Email Address
              </label>
              
              <div *ngIf="!isEditing" class="form-display">
                {{ currentUser.email }}
              </div>
              
              <input 
                *ngIf="isEditing" 
                [(ngModel)]="profileForm.email" 
                type="email" 
                class="form-input"
                placeholder="your@email.com"
                required>
            </div>

            <!-- Address -->
            <div class="form-group full-width">
              <label class="form-label">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                Default Address
              </label>
              
              <div *ngIf="!isEditing" class="form-display">
                {{ profileForm.defaultAddress || 'No address provided' }}
              </div>
              
              <textarea 
                *ngIf="isEditing" 
                [(ngModel)]="profileForm.defaultAddress" 
                class="form-textarea" 
                placeholder="Enter your full address"
                rows="3"></textarea>
            </div>
          </div>

          <!-- Action Buttons for Edit Mode -->
          <div *ngIf="isEditing" class="form-actions">
            <button (click)="saveProfile()" [disabled]="isLoading" class="btn btn-primary">
              <svg *ngIf="!isLoading" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
              <div *ngIf="isLoading" class="loading-spinner"></div>
              {{ isLoading ? 'Saving...' : 'Save Changes' }}
            </button>
            <button (click)="toggleEdit()" [disabled]="isLoading" class="btn btn-secondary">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
              Cancel
            </button>
          </div>

          <!-- Feedback Messages -->
          <div *ngIf="errorMessage" class="alert alert-error">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="15" y1="9" x2="9" y2="15"></line>
              <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
            {{ errorMessage }}
          </div>
          
          <div *ngIf="successMessage" class="alert alert-success">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20,6 9,17 4,12"></polyline>
            </svg>
            {{ successMessage }}
          </div>
        </div>
      </div>

      <!-- Account Actions Grid -->
      <div class="actions-section">
        <h2>Account Actions</h2>
        <div class="actions-grid">
          <div class="action-card" (click)="changePassword()">
            <div class="action-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <circle cx="12" cy="16" r="1"></circle>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
              </svg>
            </div>
            <div class="action-content">
              <h3>Change Password</h3>
              <p>Update your account password for security</p>
            </div>
            <div class="action-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"></polyline>
              </svg>
            </div>
          </div>
          
          <div class="action-card" routerLink="/orders">
            <div class="action-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path>
                <line x1="3" y1="8" x2="21" y2="8"></line>
                <path d="M16 11a4 4 0 0 1-8 0"></path>
              </svg>
            </div>
            <div class="action-content">
              <h3>Order History</h3>
              <p>View and track your past orders</p>
            </div>
            <div class="action-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"></polyline>
              </svg>
            </div>
          </div>
          
          <div class="action-card" routerLink="/wishlist">
            <div class="action-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"></path>
              </svg>
            </div>
            <div class="action-content">
              <h3>Wishlist</h3>
              <p>Manage your saved and favorite items</p>
            </div>
            <div class="action-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9,18 15,12 9,6"></polyline>
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf= "!currentUser" class="loading-container">
      <div class="loading-spinner"></div>
      <p>Loading your profile...</p>
    </div>
  </div>
</div>