<!-- src/app/pages/product-detail/product-detail.component.html -->

<div class="page-container">
    <!-- Loading and Error States -->
    <div *ngIf="isLoading" class="state-container"><p>Loading Product...</p></div>
    <div *ngIf="error" class="state-container error"><p>{{ error }}</p></div>
  
    <!-- Main Content, rendered only when product is loaded -->
    <div *ngIf="!isLoading && product as p" class="product-detail-container">
  
      <!-- Left Column: Product Image -->
      <div class="product-image-section">
        <img [src]="getProductImage()" [alt]="p.title">
      </div>
  
      <!-- Right Column: Product Info & Actions -->
      <div class="product-info-section">
        <div class="breadcrumbs">
      <!-- Home / {{ (p.categoryID[0] && (p.categoryID[0] as any).name) ? (p.categoryID[0] as any).name : p.categoryID[0] || 'Category' }}    -->
        </div>
        <h1 class="product-title">{{ p.title }}</h1>
        <div class="product-price">
          <!-- Price updates based on selected variant -->
          <h2>{{ selectedVariant?.price || 'Select options to see price' }} EGP</h2>
        </div>
        <div class="product-short-description">
          <p>{{ p.description.substring(0, 150) }}...</p>
        </div>
  
        <!-- Variant Selector: Color -->
        <div class="variant-group">
          <label>Color:</label>
          <div class="options">
            <button *ngFor="let color of uniqueColors"
                    class="option-btn color-option"
                    [class.active]="color === selectedColor"
                    (click)="selectColor(color)">
              {{ color }}
            </button>
          </div>
        </div>
  
        <!-- Variant Selector: Size -->
        <div class="variant-group">
          <label>Size:</label>
          <div class="options">
            <button *ngFor="let size of availableSizes"
                    class="option-btn size-option"
                    [class.active]="size === selectedSize"
                    [disabled]="isSizeOutOfStock(size)"
                    (click)="selectSize(size)">
              {{ size }}
            </button>
          </div>
        </div>
        
        <!-- Actions: Quantity and Add to Cart -->
        <div class="actions-group">
          <div class="quantity-selector">
            <button (click)="decrementQuantity()">-</button>
            <input type="number" [value]="quantity" min="1" readonly>
            <button (click)="incrementQuantity()">+</button>
          </div>
          <button class="add-to-cart-btn" 
                  (click)="addToCart()" 
                  [disabled]="!selectedVariant || selectedVariant.QTyavailable <= 0 || addingToCart">
              <span *ngIf="!addingToCart && (!selectedVariant || selectedVariant.QTyavailable > 0)">Add to Cart</span>
              <span *ngIf="!addingToCart && selectedVariant && selectedVariant.QTyavailable <= 0">Out of Stock</span>
              <span *ngIf="addingToCart">Adding to Cart...</span>
          </button>
        </div>
  
      </div>
    </div>
  
    <!-- Lower Section: Full Details -->
    <div *ngIf="!isLoading && product as p" class="product-long-details">
      <h3>Product Description</h3>
      <p>{{ p.description }}</p>
      
      <h3>Specifications</h3>
      <table class="spec-table">
          <tbody>
              <tr>
                  <td>Material</td>
                  <td>{{ p.attributes.material }}</td>
              </tr>
              <tr>
                  <td>Origin</td>
                  <td>{{ p.attributes.origin }}</td>
              </tr>
          </tbody>
      </table>
    </div>
  </div>
