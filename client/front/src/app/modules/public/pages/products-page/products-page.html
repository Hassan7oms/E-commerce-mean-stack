<!-- src/app/pages/product-detail/product-detail.component.html -->

<div class="page-container">
    <!-- Loading and Error States -->
    <div *ngIf="isLoading" class="state-container"><p>Loading Product...</p></div>
    <div *ngIf="error" class="state-container error"><p>{{ error }}</p></div>
  
    <!-- Main Content, rendered only when product is loaded -->
    <div *ngIf="!isLoading && product as p" class="product-detail-container">
  
      <!-- Left Column: Product Image -->
      <div class="product-image-section">
        <img [src]="getProductImage()" [alt]="p.title">
      </div>
  
      <!-- Right Column: Product Info & Actions -->
      <div class="product-info-section">
        <div class="breadcrumbs">
          <span>Home</span> 
          <span *ngIf="p.categoryID && p.categoryID[0]"> / {{ getCategoryName(p.categoryID[0]) }}</span>
          <span> / {{ p.title }}</span>
        </div>
        
        <h1 class="product-title">{{ p.title }}</h1>
        
        <div class="product-price">
          <h2 *ngIf="selectedVariant; else noVariantPrice">{{ selectedVariant.price }} EGP</h2>
          <ng-template #noVariantPrice>
            <h2 class="price-placeholder">Select options to see price</h2>
          </ng-template>
        </div>
        
        <div class="product-short-description">
          <p>{{ p.description.length > 150 ? (p.description.substring(0, 150) + '...') : p.description }}</p>
        </div>
  
        <!-- Variant Selector: Color -->
        <div class="variant-group">
          <label>Color:</label>
          <div class="options">
            <button *ngFor="let color of uniqueColors"
                    class="option-btn color-option"
                    [class.active]="color === selectedColor"
                    (click)="selectColor(color)">
              {{ color }}
            </button>
          </div>
        </div>
  
        <!-- Variant Selector: Size -->
        <div class="variant-group">
          <label>Size:</label>
          <div class="options">
            <button *ngFor="let size of availableSizes"
                    class="option-btn size-option"
                    [class.active]="size === selectedSize"
                    [disabled]="isSizeOutOfStock(size)"
                    (click)="selectSize(size)">
              {{ size }}
            </button>
          </div>
        </div>
        
        <!-- Actions: Quantity, Add to Cart, and Add to Wishlist -->
        <div class="actions-group">
          <div class="quantity-selector">
            <button (click)="decrementQuantity()" class="quantity-btn">-</button>
            <input type="number" [value]="quantity" min="1" readonly>
            <button (click)="incrementQuantity()" class="quantity-btn">+</button>
          </div>
          <button class="add-to-cart-btn" 
                  (click)="addToCart()" 
                  [disabled]="!selectedVariant || selectedVariant.QTyavailable <= 0 || addingToCart">
              <span *ngIf="!addingToCart && (!selectedVariant || selectedVariant.QTyavailable > 0)">Add to Cart</span>
              <span *ngIf="!addingToCart && selectedVariant && selectedVariant.QTyavailable <= 0">Out of Stock</span>
              <span *ngIf="addingToCart">Adding...</span>
          </button>
          <button class="add-to-wishlist-btn" 
                  (click)="addToWishlist()" 
                  [disabled]="addingToWishlist"
                  title="Add to Wishlist">
              <svg *ngIf="!addingToWishlist" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
              </svg>
              <span *ngIf="addingToWishlist" class="wishlist-spinner">â™¡</span>
          </button>
        </div>
  
      </div>
    </div>
  
    <!-- Lower Section: Full Details -->
    <div *ngIf="!isLoading && product as p" class="product-long-details">
      <h3>Product Description</h3>
      <p>{{ p.description }}</p>
      
      <h3>Specifications</h3>
      <table class="spec-table">
          <tbody>
              <tr>
                  <td>Material</td>
                  <td>{{ p.attributes.material }}</td>
              </tr>
              <tr>
                  <td>Origin</td>
                  <td>{{ p.attributes.origin }}</td>
              </tr>
          </tbody>
      </table>
    </div>
  </div>
